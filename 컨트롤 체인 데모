<template>
  <div class="demo-wrapper">
    <h3>ControlChain Demo (latest)</h3>

    <!-- 옵션 패널 -->
    <div class="demo-controls">
      <div class="demo-controls__row">
        <label>
          width:
          <input
            type="number"
            v-model.number="widthInput"
            placeholder="예: 900"
          />
        </label>

        <label>
          height:
          <input
            type="number"
            v-model.number="heightInput"
            placeholder="예: 260"
          />
        </label>

        <label>
          가로 스크롤:
          <input
            type="checkbox"
            v-model="useHorizontalScroll"
          />
        </label>

        <label>
          세로 스크롤:
          <input
            type="checkbox"
            v-model="useVerticalScroll"
          />
        </label>
      </div>

      <div class="demo-controls__row">
        <label>
          목록 위치:
          <select v-model="availablePlacement">
            <option value="right">오른쪽</option>
            <option value="left">왼쪽</option>
          </select>
        </label>

        <label>
          목록 타이틀:
          <input
            type="text"
            v-model="availableTitle"
            placeholder="사용 가능한 컨트롤"
          />
        </label>

        <label class="demo-controls__empty-guide">
          안내 문구:
          <input
            type="text"
            v-model="emptyGuideText"
            placeholder="목록에서 드래그하여 추가해 주세요."
          />
        </label>
      </div>
    </div>

    <!-- 컨트롤체인: 부모 레이아웃 단순화 -->
    <div class="demo-chain-container">
      <control-chain
        ref="chain"
        v-model="chain"
        :control-templates="controlTemplates"
        :available-placement="availablePlacement"
        :width="resolvedWidth"
        :height="resolvedHeight"
        :use-horizontal-scroll="useHorizontalScroll"
        :use-vertical-scroll="useVerticalScroll"
        :available-title="availableTitle"
        :empty-guide-text="emptyGuideText"
        @control-added="logEvent('added', $event)"
        @control-removed="logEvent('removed', $event)"
        @control-depth-change="logEvent('depth-change', $event)"
        @control-selection-change="logEvent('selection-change', $event)"
      />
    </div>

    <!-- 현재 체인 값 확인용 -->
    <div class="demo-log-wrapper">
      <div class="demo-log-title">현재 체인 값 (v-model)</div>
      <pre class="demo-log">
{{ formattedChain }}
      </pre>
    </div>
  </div>
</template>

<script>
import ControlChain from '@/components/ControlChain.vue';

export default {
  name: 'ControlChainDemoLatest',
  components: { ControlChain },

  data() {
    return {
      widthInput: 900,
      heightInput: 260,
      useHorizontalScroll: false,
      useVerticalScroll: false,
      availablePlacement: 'right',
      availableTitle: '사용 가능한 컨트롤',
      emptyGuideText: '목록에서 드래그하여 추가해 주세요.',

      controlTemplates: [
        {
          key: 'AAA',
          label: 'AAA (single, max 200px)',
          type: 'single',
          items: [
            { text: 'AAA1', value: 'aaa1' },
            { text: 'AAA2', value: 'aaa2' },
            { text: 'AAA3', value: 'aaa3' }
          ],
          selectedValue: 'aaa1',
          maxWidth: 200
        },
        {
          key: 'BBB',
          label: 'BBB (multi, all-select)',
          type: 'multi',
          items: [
            { text: 'BBB1', value: 'bbb1' },
            { text: 'BBB2', value: 'bbb2' },
            { text: 'BBB3', value: 'bbb3' }
          ],
          selectedValues: [],
          allSelect: true,
          maxWidth: 260
        },
        {
          key: 'CCC',
          label: 'CCC (label)',
          type: 'label',
          displayValue: '고정 라벨입니다'
        },
        {
          key: 'DDD',
          label: 'DDD (single)',
          type: 'single',
          items: [
            { text: 'DDD1', value: 'ddd1' },
            { text: 'DDD2', value: 'ddd2' },
            { text: 'DDD3', value: 'ddd3' }
          ],
          selectedValue: 'ddd2'
        },
        {
          key: 'EEE',
          label: 'EEE (multi, no all-select)',
          type: 'multi',
          items: [
            { text: 'EEE1', value: 'eee1' },
            { text: 'EEE2', value: 'eee2' },
            { text: 'EEE3', value: 'eee3' }
          ],
          selectedValues: ['eee2'],
          allSelect: false
        },
        {
          key: 'FFF',
          label: 'FFF (label, max 180px)',
          type: 'label',
          displayValue: '기본 조건',
          maxWidth: 180
        }
      ],

      chain: []
    };
  },

  computed: {
    resolvedWidth() {
      if (this.widthInput === null || this.widthInput === '') {
        return null;
      }
      const numeric = Number(this.widthInput);
      if (Number.isNaN(numeric)) {
        return null;
      }
      return numeric;
    },

    resolvedHeight() {
      if (this.heightInput === null || this.heightInput === '') {
        return null;
      }
      const numeric = Number(this.heightInput);
      if (Number.isNaN(numeric)) {
        return null;
      }
      return numeric;
    },

    formattedChain() {
      try {
        return JSON.stringify(this.chain, null, 2);
      } catch (error) {
        return String(this.chain);
      }
    }
  },

  methods: {
    logEvent(type, payload) {
      console.log(`[ControlChain ${type}]`, payload);
    }
  }
};
</script>

<style scoped>
.demo-wrapper {
  padding: 16px;
  box-sizing: border-box;
  font-size: 13px;
}

.demo-controls {
  margin-bottom: 12px;
  padding: 8px;
  border: 1px solid #e5e5e5;
  background: #fafafa;
  box-sizing: border-box;
}

.demo-controls__row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 8px;
}

.demo-controls__row:last-child {
  margin-bottom: 0;
}

.demo-controls label {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
}

.demo-controls input[type='number'],
.demo-controls input[type='text'],
.demo-controls select {
  font-size: 12px;
  padding: 2px 4px;
  box-sizing: border-box;
}

.demo-controls__empty-guide {
  flex: 1 1 auto;
}

/* 부모 레이아웃 효과 최소화 */
.demo-chain-container {
  margin-top: 12px;
  margin-bottom: 12px;
  display: inline-block;
}

/* 체인 영역이 눈에 보이도록 약한 테두리 */
.demo-chain-container > .control-chain {
  outline: 1px dashed #cccccc;
}

.demo-log-wrapper {
  margin-top: 8px;
}

.demo-log-title {
  font-size: 12px;
  margin-bottom: 4px;
}

.demo-log {
  font-size: 11px;
  background: #f5f5f5;
  border: 1px solid #e0e0e0;
  padding: 8px;
  max-height: 220px;
  overflow: auto;
  box-sizing: border-box;
}
</style>