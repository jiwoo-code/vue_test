
âœ… â‘  ìµœì¢… ì™„ì„±ë³¸ ControlChain.vue (ì „ì²´ ì½”ë“œ)
(ur-dropdown / ur-multi-dropdown ì „ì—­ ì»´í¬ë„ŒíŠ¸, import ë¶ˆí•„ìš”)
ì½”ë“œ ë³µì‚¬
Vue
<!--
  ---------------------------------------------------------------------------
  í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬

  vuedraggable (Sortable.js ê¸°ë°˜ ë“œë˜ê·¸)
    npm install vuedraggable sortablejs
    yarn add vuedraggable sortablejs

  ---------------------------------------------------------------------------
-->

<template>
  <div
    class="control-chain"
    :class="layoutClass"
  >
    <!-- ========================= -->
    <!--       í™œì„± ì²´ì¸ ì˜ì—­      -->
    <!-- ========================= -->
    <div class="control-chain__active">
      <draggable
        v-model="activeControls"
        :group="dragGroup"
        item-key="id"
        class="control-chain__draggable"
        :handle="dragHandleSelector"
        @change="onActiveChange"
      >
        <template #item="{ element, index }">
          <div class="control-chain__item">
            <!-- êµ¬ë¶„ì í‘œì‹œ (AAA >> BBB >> ...) -->
            <span v-if="index > 0" class="control-chain__separator">>></span>

            <div
              class="control-chain__content"
              @mouseenter="onControlMouseEnter(element)"
              @mouseleave="onControlMouseLeave(element)"
            >
              <div class="control-chain__header">
                <span class="control-chain__title">{{ element.label }}</span>

                <div class="control-chain__header-right">
                  <!-- ë“œë˜ê·¸ í•¸ë“¤ (hover ì‹œ í‘œì‹œ) -->
                  <span
                    v-if="hoveredControlId === element.id"
                    class="control-chain__drag-handle"
                  >
                    â‰¡
                  </span>

                  <!-- X ë²„íŠ¼ (hover 1ì´ˆ í›„ í‘œì‹œ) -->
                  <button
                    v-if="showCloseControlId === element.id"
                    class="control-chain__close-button"
                    @click.stop="removeControlById(element.id)"
                  >
                    âœ•
                  </button>
                </div>
              </div>

              <div class="control-chain__body">
                <!-- ë‹¨ì¼ ì„ íƒ (ur-dropdown) -->
                <ur-dropdown
                  v-if="element.type === 'single'"
                  class="control-chain__dropdown"
                  v-model="element.selectedValue"
                  :item="element.options || []"
                  @input="onSingleSelectChange(element, index, $event)"
                />

                <!-- ë‹¤ì¤‘ ì„ íƒ (ur-multi-dropdown) -->
                <ur-multi-dropdown
                  v-else-if="element.type === 'multi'"
                  class="control-chain__dropdown control-chain__dropdown--multi"
                  v-model="element.selectedValues"
                  :item="element.options || []"
                  @input="onMultiSelectChange(element, index, $event)"
                />

                <!-- í‘œì‹œ ì „ìš© ë¼ë²¨ -->
                <span v-else class="control-chain__label-value">
                  {{ element.displayValue || '-' }}
                </span>
              </div>
            </div>
          </div>
        </template>

        <template #footer>
          <div v-if="!activeControls.length" class="control-chain__empty">
            ì‚¬ìš© ê°€ëŠ¥í•œ ì»¨íŠ¸ë¡¤ ëª©ë¡ì—ì„œ ë“œë˜ê·¸í•´ ì¶”ê°€í•˜ì„¸ìš”.
          </div>
        </template>
      </draggable>
    </div>

    <!-- ========================= -->
    <!--   ì‚¬ìš© ê°€ëŠ¥í•œ ì»¨íŠ¸ë¡¤ ëª©ë¡  -->
    <!-- ========================= -->
    <div class="control-chain__available">
      <div class="control-chain__available-title">ì‚¬ìš© ê°€ëŠ¥í•œ ì»¨íŠ¸ë¡¤</div>

      <draggable
        v-model="availableControls"
        :group="dragGroup"
        item-key="id"
        class="control-chain__available-list"
        :handle="dragHandleSelector"
      >
        <template #item="{ element }">
          <li class="control-chain__available-item">
            <div
              class="control-chain__available-content"
              @mouseenter="onControlMouseEnter(element)"
              @mouseleave="onControlMouseLeave(element)"
            >
              <span class="control-chain__available-label">
                {{ element.label }}
              </span>

              <span
                v-if="hoveredControlId === element.id"
                class="control-chain__drag-handle control-chain__drag-handle--small"
              >
                â‰¡
              </span>
            </div>
          </li>
        </template>
      </draggable>
    </div>
  </div>
</template>

<script>
import draggable from 'vuedraggable';

export default {
  name: 'ControlChain',
  components: { draggable },
  model: { prop: 'value', event: 'input' },

  props: {
    /* í˜„ì¬ ì²´ì¸ì— ìœ„ì¹˜í•œ ì»¨íŠ¸ë¡¤ ëª©ë¡ */
    value: {
      type: Array,
      default() {
        return [];
      }
    },

    /* ì „ì²´ ì»¨íŠ¸ë¡¤ í…œí”Œë¦¿ */
    controlTemplates: {
      type: Array,
      required: true
    },

    /* ì˜¤ë¥¸ìª½ ëª©ë¡ ìœ„ì¹˜ (right, left, top, bottom) */
    availablePlacement: {
      type: String,
      default: 'right',
      validator(v) {
        return ['right', 'left', 'top', 'bottom'].includes(v);
      }
    }
  },

  data() {
    const usedSet = new Set(
      (this.value || []).map(c => c.key || c.label)
    );

    return {
      activeControls: this.value.slice(),

      /* ì²´ì¸ì— ì—†ëŠ” ì»¨íŠ¸ë¡¤ë§Œ availableë¡œ ì´ˆê¸° í‘œì‹œ */
      availableControls: this.controlTemplates
        .filter(t => !usedSet.has(t.key || t.label))
        .map(t => ({
          ...t,
          id: t.id || this.makeId(t)
        })),

      dragGroup: { name: 'control-chain', pull: true, put: true },
      dragHandleSelector: '.control-chain__drag-handle',

      hoveredControlId: null,
      hoverTimerId: null,
      showCloseControlId: null
    };
  },

  computed: {
    layoutClass() {
      return `control-chain--available-${this.availablePlacement}`;
    }
  },

  watch: {
    value(newVal) {
      this.activeControls = Array.isArray(newVal) ? newVal.slice() : [];
    }
  },

  methods: {
    /* ------- ë“œë˜ê·¸ ë³€ê²½ ì´ë²¤íŠ¸ ------- */
    onActiveChange(e) {
      if (e.added) {
        this.emitChain();
        this.$emit('control-added', {
          control: e.added.element,
          index: e.added.newIndex
        });
      }

      if (e.moved) {
        this.emitChain();
        this.$emit('control-depth-change', {
          control: e.moved.element,
          oldIndex: e.moved.oldIndex,
          newIndex: e.moved.newIndex
        });
      }

      if (e.removed) {
        this.emitChain();
        this.$emit('control-removed', {
          control: e.removed.element,
          index: e.removed.oldIndex
        });
      }

      if (!e.added && !e.moved && !e.removed) {
        this.emitChain();
      }
    },

    /* ------- ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸ ------- */
    onSingleSelectChange(control, index, value) {
      control.selectedValue = value;
      this.emitChain();
      this.$emit('control-selection-change', {
        control,
        index,
        type: 'single',
        value
      });
    },

    onMultiSelectChange(control, index, values) {
      control.selectedValues = Array.isArray(values) ? values.slice() : [];
      this.emitChain();
      this.$emit('control-selection-change', {
        control,
        index,
        type: 'multi',
        values: control.selectedValues
      });
    },

    /* ------- X ë²„íŠ¼ ì œê±° ------- */
    removeControlById(id) {
      const idx = this.activeControls.findIndex(c => c.id === id);
      if (idx === -1) return;

      const [removed] = this.activeControls.splice(idx, 1);
      this.availableControls.push(removed);

      this.emitChain();
      this.$emit('control-removed', { control: removed, index: idx });
    },

    /* ------- hover ì²˜ë¦¬ ------- */
    onControlMouseEnter(control) {
      this.hoveredControlId = control.id;

      if (this.hoverTimerId) clearTimeout(this.hoverTimerId);

      this.hoverTimerId = setTimeout(() => {
        this.showCloseControlId = control.id;
      }, 1000);
    },

    onControlMouseLeave(control) {
      this.hoveredControlId = null;
      if (this.hoverTimerId) clearTimeout(this.hoverTimerId);
      this.hoverTimerId = null;

      if (this.showCloseControlId === control.id) {
        this.showCloseControlId = null;
      }
    },

    /* ------- ì²´ì¸ ë³€ê²½ emit ------- */
    emitChain() {
      const cloned = this.activeControls.map(c => ({
        ...c,
        selectedValues: Array.isArray(c.selectedValues)
          ? c.selectedValues.slice()
          : c.selectedValues
      }));

      this.$emit('input', cloned);
      this.$emit('change', cloned);
    },

    /* ------- ID ìƒì„± ------- */
    makeId(t) {
      return `${t.key || t.label}-${Date.now()}-${Math.random()
        .toString(36)
        .slice(2, 8)}`;
    }
  }
};
</script>

<style scoped>
/* ë ˆì´ì•„ì›ƒ */
.control-chain {
  display: flex;
  gap: 16px;
  align-items: flex-start;
}

/* ìœ„ì¹˜ ì˜µì…˜ */
.control-chain--available-right {
  flex-direction: row;
}
.control-chain--available-left {
  flex-direction: row-reverse;
}
.control-chain--available-top {
  flex-direction: column-reverse;
}
.control-chain--available-bottom {
  flex-direction: column;
}

/* active ì˜ì—­ */
.control-chain__active {
  flex: 1;
}
.control-chain__draggable {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.control-chain__item {
  display: flex;
  align-items: center;
}
.control-chain__separator {
  margin-right: 4px;
}

.control-chain__content {
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 6px 8px;
  background: #fafafa;
  min-width: 160px;
}

.control-chain__header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
}

.control-chain__drag-handle {
  cursor: grab;
  font-size: 12px;
}

.control-chain__close-button {
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 12px;
}

.control-chain__body {
  display: flex;
  align-items: center;
  gap: 4px;
}

.control-chain__dropdown {
  width: 100%;
}

.control-chain__empty {
  font-size: 12px;
  color: #999;
}

/* available ì˜ì—­ */
.control-chain__available {
  width: 180px;
}

.control-chain__available-title {
  margin-bottom: 8px;
  font-weight: bold;
}

.control-chain__available-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.control-chain__available-item + .control-chain__available-item {
  margin-top: 4px;
}

.control-chain__available-content {
  border: 1px dashed #ccc;
  padding: 4px 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
âœ… â‘¡ ì‚¬ìš© ìƒ˜í”Œ ì½”ë“œ (ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ)
ì•„ë˜ ì˜ˆì‹œëŠ” ControlChain.vueë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹¤ì œ í˜ì´ì§€ êµ¬ì¡°ì…ë‹ˆë‹¤.
ì½”ë“œ ë³µì‚¬
Vue
<template>
  <div>
    <control-chain
      v-model="chain"
      :control-templates="controlTemplates"
      available-placement="right"
      @control-added="logEvent"
      @control-removed="logEvent"
      @control-depth-change="logEvent"
      @control-selection-change="logEvent"
    />
  </div>
</template>

<script>
import ControlChain from '@/components/ControlChain.vue';

export default {
  name: 'ControlChainDemo',
  components: { ControlChain },

  data() {
    return {
      /* ì „ì²´ í…œí”Œë¦¿ */
      controlTemplates: [
        {
          key: 'AAA',
          label: 'AAA',
          type: 'single',
          options: [
            { label: 'AAA1', value: 'aaa1' },
            { label: 'AAA2', value: 'aaa2' }
          ],
          selectedValue: 'aaa1'
        },
        {
          key: 'BBB',
          label: 'BBB',
          type: 'multi',
          options: [
            { label: 'BBB1', value: 'bbb1' },
            { label: 'BBB2', value: 'bbb2' }
          ],
          selectedValues: []
        },
        {
          key: 'CCC',
          label: 'CCC',
          type: 'label',
          displayValue: 'ê³ ì • ë¼ë²¨'
        }
      ],

      /* í˜„ì¬ ì²´ì¸ */
      chain: []   // AAA >> BBB >> ... ì´ëŸ° ì‹ìœ¼ë¡œ êµ¬ì„±ë¨
    };
  },

  methods: {
    logEvent(e) {
      console.log('EVENT:', e);
    }
  }
};
</script>
ğŸ‰ ì´ì œ ì™„ì „íˆ ì‹¤ì „ì— íˆ¬ì…í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ì´ì—ìš”!
ì§€ìš°ë‹˜ ìš”êµ¬í•˜ì‹  ê¸°ëŠ¥ì´ ëª¨ë‘ ë“¤ì–´ìˆìŠµë‹ˆë‹¤:
âœ” ë“œë˜ê·¸ í•¸ë“¤(â‰¡)ë¡œë§Œ ìˆœì„œ ë³€ê²½
âœ” ì˜¤ë¥¸ìª½ ëª©ë¡ì—ì„œ ë“œë˜ê·¸í•´ ì²´ì¸ ì¶”ê°€
âœ” ì²´ì¸ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë“œë˜ê·¸í•˜ë©´ ì œê±°
âœ” hover 1ì´ˆ í›„ X ë²„íŠ¼ ë“±ì¥
âœ” ur-dropdown, ur-multi-dropdown ì ìš©
âœ” availablePlacement â†’ right/left/top/bottom ì§€ì›
âœ” ì²´ì¸ì— ìˆëŠ” í•­ëª©ì€ ëª©ë¡ì—ì„œ ìë™ ì œê±°
