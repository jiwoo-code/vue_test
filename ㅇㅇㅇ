with
params as (
    select
        'PAXV813'::text as eqp_id
      , '2026-01-13 11:15:21'::timestamp as start_ts
      , '2026-01-13 12:15:21'::timestamp as end_ts
),
prod_wafer as (
    select distinct
        p.wafer_seq
    from eqp_prod_std_wafer_hist p
    join params x
    on p.eqp_id = x.eqp_id
    where p.exp_start_tmstp >= x.start_ts
    and p.exp_start_tmstp <= x.end_ts
    and p.wafer_seq is not null
),
wst_wafer as (
    select distinct
        w.wafer_seq
    from anal_algrth_wst_result_hist w
    join params x
    on w.eqp_id = x.eqp_id
    join prod_wafer pw
    on pw.wafer_seq = w.wafer_seq
    where w.summary_date between x.start_ts::date - interval '1 day' and x.end_ts::date + interval '1 day'
),
loh_wafer as (
    select distinct
        l.wafer_seq
    from prism_ops.anal_algrth_loh_result_hist l
    join params x
    on l.eqp_id = x.eqp_id
    join prod_wafer pw
    on pw.wafer_seq = l.wafer_seq
    where l.summary_date between x.start_ts::date - interval '1 day' and x.end_ts::date + interval '1 day'
)
select
    (select count(*) from prod_wafer) as prod_wafer_count
  , (select count(*) from wst_wafer) as wst_wafer_count
  , (select count(*) from loh_wafer) as loh_wafer_count
  , (
        select count(*)
        from wst_wafer w
        join loh_wafer l
        on l.wafer_seq = w.wafer_seq
    ) as wst_loh_intersection_count;