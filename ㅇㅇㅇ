with
params as (
    select
        'PAXV813'::text as eqp_id
      , '2026-01-13 00:00:00'::timestamp as start_ts
      , '2026-01-14 00:00:00'::timestamp as end_ts
),
sy_keys as (
    select distinct
        s.lot_id
      , trim(s.slot_seq::text) as slot_seq
    from eqp_prod_sy_map_hist s
    join params x
    on s.eqp_id = x.eqp_id
    where s.process_start_tmstp >= x.start_ts
    and s.process_start_tmstp <= x.end_ts
),
prod_keys as (
    select distinct
        p.lot_id
      , trim(p.slot_seq::text) as slot_seq
    from eqp_prod_std_wafer_hist p
    join params x
    on p.eqp_id = x.eqp_id
    where p.exp_start_tmstp >= x.start_ts
    and p.exp_start_tmstp <= x.end_ts
)
select
    count(*) as key_intersection_count
from sy_keys s
join prod_keys p
on p.lot_id = s.lot_id
and p.slot_seq = s.slot_seq;